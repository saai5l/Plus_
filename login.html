<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ±ÙØ± â€” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
  <link rel="icon" type="image/png" href="Plus_Dev_No_Wellpeper.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#fc7823">
  <style>
    :root { --primary:#fc7823; --primary-dark:#e66a1f; --discord:#5865F2; --discord-dark:#4752c4; }
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Tajawal',sans-serif;background:#050505;color:#e0e0e0;min-height:100vh;display:flex;overflow:hidden;}

    /* â•â•â• BRAND PANEL â•â•â• */
    .brand-panel{
      flex:1;background:linear-gradient(160deg,#0c0c0e,#080808);
      border-left:1px solid rgba(252,120,35,0.1);
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      padding:60px 50px;position:relative;overflow:hidden;
    }
    .brand-panel::before{
      content:'';position:absolute;inset:0;
      background-image:linear-gradient(rgba(252,120,35,0.04) 1px,transparent 1px),linear-gradient(90deg,rgba(252,120,35,0.04) 1px,transparent 1px);
      background-size:50px 50px;
    }
    .bp-orb{position:absolute;border-radius:50%;pointer-events:none;}
    .bp-orb-1{width:450px;height:450px;top:-120px;right:-120px;background:radial-gradient(circle,rgba(252,120,35,0.09) 0%,transparent 70%);}
    .bp-orb-2{width:320px;height:320px;bottom:-80px;left:-80px;background:radial-gradient(circle,rgba(252,120,35,0.05) 0%,transparent 70%);}

    .bp-content{position:relative;z-index:2;text-align:center;max-width:400px;}
    .bp-logo{
      width:88px;height:88px;border-radius:50%;
      border:2px solid rgba(252,120,35,0.5);
      box-shadow:0 0 40px rgba(252,120,35,0.2),0 0 80px rgba(252,120,35,0.08);
      margin-bottom:26px;
      animation:logoPulse 3s ease-in-out infinite;
    }
    @keyframes logoPulse{0%,100%{box-shadow:0 0 40px rgba(252,120,35,0.2),0 0 80px rgba(252,120,35,0.08);}50%{box-shadow:0 0 60px rgba(252,120,35,0.35),0 0 100px rgba(252,120,35,0.12);}}

    .bp-title{font-size:2.8rem;font-weight:900;color:#fff;line-height:1.1;margin-bottom:12px;}
    .bp-title span{color:var(--primary);}
    .bp-desc{color:#555;font-size:0.9rem;line-height:1.7;margin-bottom:32px;}

    .bp-stats{display:flex;gap:14px;justify-content:center;margin-bottom:32px;}
    .bp-stat{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:14px;padding:14px 18px;flex:1;text-align:center;}
    .bp-stat-num{font-size:1.35rem;font-weight:900;color:#fff;}
    .bp-stat-num span{color:var(--primary);}
    .bp-stat-lbl{font-size:0.7rem;color:#444;margin-top:3px;}

    .bp-features{display:flex;flex-direction:column;gap:10px;text-align:right;}
    .bp-feat{display:flex;align-items:center;gap:12px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);border-radius:12px;padding:12px 16px;transition:all 0.3s;}
    .bp-feat:hover{border-color:rgba(252,120,35,0.2);background:rgba(252,120,35,0.04);}
    .bp-feat-icon{width:36px;height:36px;background:rgba(252,120,35,0.12);border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--primary);font-size:0.88rem;flex-shrink:0;}
    .bp-feat-text{font-size:0.83rem;color:#777;line-height:1.4;}
    .bp-feat-text strong{color:#ccc;display:block;font-size:0.86rem;}

    /* â•â•â• FORM PANEL â•â•â• */
    .form-panel{
      width:480px;flex-shrink:0;
      background:rgba(9,9,11,0.99);
      border-left:1px solid rgba(255,255,255,0.05);
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      padding:50px 44px;position:relative;overflow-y:auto;
    }
    .form-panel::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,var(--primary),transparent);}

    .back-btn{
      position:absolute;top:18px;right:18px;
      display:flex;align-items:center;gap:7px;
      color:#444;text-decoration:none;font-size:0.82rem;
      padding:8px 14px;background:rgba(255,255,255,0.03);
      border:1px solid rgba(255,255,255,0.07);border-radius:10px;
      transition:all 0.25s;
    }
    .back-btn:hover{color:var(--primary);border-color:rgba(252,120,35,0.3);}

    .form-inner{width:100%;max-width:360px;}

    .form-greeting{margin-bottom:26px;}
    .form-tag{display:inline-flex;align-items:center;gap:6px;background:rgba(252,120,35,0.1);border:1px solid rgba(252,120,35,0.22);color:var(--primary);font-size:0.74rem;padding:4px 12px;border-radius:20px;margin-bottom:12px;}
    .form-tag-dot{width:7px;height:7px;background:#2ecc71;border-radius:50%;animation:blink 2s infinite;}
    @keyframes blink{0%,100%{opacity:1;}50%{opacity:0.4;}}
    .form-greeting h2{font-size:1.55rem;font-weight:900;color:#fff;}
    .form-greeting p{color:#555;font-size:0.84rem;margin-top:5px;}

    .tabs{display:flex;gap:4px;background:rgba(255,255,255,0.04);border-radius:10px;padding:4px;margin-bottom:22px;}
    .tab{flex:1;padding:9px 0;border:none;border-radius:7px;font-family:'Tajawal',sans-serif;font-size:0.87rem;font-weight:700;color:#555;background:transparent;cursor:pointer;transition:all 0.25s;}
    .tab.on{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;box-shadow:0 4px 14px rgba(252,120,35,0.28);}
    .tab i{margin-left:5px;}

    .panel{display:none;animation:panIn 0.3s ease;}
    .panel.on{display:block;}
    @keyframes panIn{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}

    .alert{display:none;align-items:center;gap:9px;padding:11px 14px;border-radius:10px;font-size:0.84rem;font-weight:600;margin-bottom:18px;animation:aIn 0.3s ease;}
    @keyframes aIn{from{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:none}}
    .alert.on{display:flex;}
    .alert.err{background:rgba(231,76,60,0.12);border:1px solid rgba(231,76,60,0.28);color:#ff7070;}
    .alert.ok{background:rgba(46,204,113,0.1);border:1px solid rgba(46,204,113,0.28);color:#5dda8f;}
    .alert.inf{background:rgba(252,120,35,0.1);border:1px solid rgba(252,120,35,0.28);color:#fca366;}

    .discord-btn{
      width:100%;display:flex;align-items:center;justify-content:center;gap:11px;
      padding:15px;background:linear-gradient(135deg,var(--discord),var(--discord-dark));
      border:none;border-radius:14px;color:#fff;
      font-family:'Tajawal',sans-serif;font-size:0.98rem;font-weight:800;
      cursor:pointer;transition:all 0.25s;
      box-shadow:0 6px 20px rgba(88,101,242,0.28);position:relative;overflow:hidden;
    }
    .discord-btn::after{content:'';position:absolute;inset:0;background:rgba(255,255,255,0.1);opacity:0;transition:opacity 0.3s;}
    .discord-btn:hover{transform:translateY(-2px);box-shadow:0 10px 28px rgba(88,101,242,0.45);}
    .discord-btn:hover::after{opacity:1;}
    .discord-btn i{font-size:1.2rem;}
    .discord-note{font-size:0.77rem;color:#444;text-align:center;margin-top:11px;line-height:1.6;}

    .alt-login-box{background:rgba(252,120,35,0.04);border:1px solid rgba(252,120,35,0.12);border-radius:14px;padding:16px;text-align:center;margin-top:16px;}
    .alt-login-box p{font-size:0.81rem;color:#444;margin-bottom:10px;}
    .alt-login-btn{width:100%;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.09);color:#777;border-radius:10px;padding:10px;cursor:pointer;font-family:'Tajawal',sans-serif;font-size:0.85rem;font-weight:700;transition:all 0.25s;}
    .alt-login-btn:hover{border-color:rgba(252,120,35,0.3);color:var(--primary);}

    .div{display:flex;align-items:center;gap:10px;color:#333;font-size:0.77rem;margin:20px 0;}
    .div::before,.div::after{content:'';flex:1;height:1px;background:rgba(255,255,255,0.06);}

    .link-banner{display:none;padding:13px 15px;background:linear-gradient(135deg,rgba(88,101,242,0.1),rgba(252,120,35,0.05));border:1px solid rgba(88,101,242,0.22);border-radius:12px;margin-bottom:18px;font-size:0.82rem;color:#666;line-height:1.6;}
    .link-banner.on{display:block;}
    .link-banner strong{color:#9da7fb;}
    .link-actions{display:flex;gap:8px;margin-top:10px;}
    .lbtn{flex:1;padding:9px;border-radius:8px;border:none;font-family:'Tajawal',sans-serif;font-size:0.82rem;font-weight:800;cursor:pointer;transition:all 0.2s;}
    .lbtn-y{background:var(--discord);color:#fff;}
    .lbtn-y:hover{background:var(--discord-dark);}
    .lbtn-n{background:rgba(255,255,255,0.06);color:#555;}
    .lbtn-n:hover{background:rgba(255,255,255,0.1);}

    .fg{margin-bottom:15px;}
    label{display:block;font-size:0.8rem;font-weight:700;color:#555;margin-bottom:7px;}
    .iw{position:relative;}
    .iw i.ic{position:absolute;top:50%;transform:translateY(-50%);right:14px;color:#444;font-size:0.84rem;pointer-events:none;transition:color 0.3s;}
    input[type="email"],input[type="password"],input[type="text"]{
      width:100%;padding:13px 42px 13px 44px;
      background:rgba(255,255,255,0.04);border:1.5px solid rgba(255,255,255,0.07);
      border-radius:12px;color:#e0e0e0;font-family:'Tajawal',sans-serif;font-size:0.92rem;outline:none;transition:all 0.25s;
    }
    input:focus{border-color:rgba(252,120,35,0.5);background:rgba(252,120,35,0.04);box-shadow:0 0 0 3px rgba(252,120,35,0.08);}
    input:focus~i.ic,.iw:focus-within i.ic{color:var(--primary);}
    input::placeholder{color:rgba(255,255,255,0.17);}
    .eye{position:absolute;top:50%;transform:translateY(-50%);left:12px;background:none;border:none;color:#444;cursor:pointer;font-size:0.84rem;padding:4px;transition:color 0.3s;}
    .eye:hover{color:var(--primary);}
    .extras{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;font-size:0.8rem;}
    .rem{display:flex;align-items:center;gap:7px;cursor:pointer;color:#555;user-select:none;}
    .rem input[type="checkbox"]{accent-color:var(--primary);width:14px;height:14px;}
    .forgot{color:var(--primary);text-decoration:none;transition:opacity 0.25s;}
    .forgot:hover{opacity:0.7;}

    .sbtn{
      width:100%;padding:14px;
      background:linear-gradient(135deg,var(--primary),var(--primary-dark));
      border:none;border-radius:14px;color:#fff;
      font-family:'Tajawal',sans-serif;font-size:0.98rem;font-weight:800;
      cursor:pointer;transition:all 0.25s;
      box-shadow:0 6px 20px rgba(252,120,35,0.22);
    }
    .sbtn:hover{transform:translateY(-2px);box-shadow:0 10px 28px rgba(252,120,35,0.38);}
    .sbtn:disabled{opacity:0.5;cursor:not-allowed;transform:none;}
    .spin{display:inline-block;width:15px;height:15px;border:2px solid rgba(255,255,255,0.3);border-top-color:#fff;border-radius:50%;animation:sp 0.7s linear infinite;vertical-align:middle;margin-left:7px;}
    @keyframes sp{to{transform:rotate(360deg)}}

    .sw{text-align:center;margin-top:15px;font-size:0.8rem;color:#444;}
    .sw a{color:var(--primary);text-decoration:none;font-weight:700;}
    .sw a:hover{text-decoration:underline;}

    .foot{text-align:center;margin-top:22px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.05);font-size:0.74rem;color:#333;}
    .foot a{color:var(--primary);text-decoration:none;}

    @media(max-width:900px){
      .brand-panel{display:none;}
      .form-panel{width:100%;border:none;padding:40px 22px;}
    }
  </style>
</head>
<body>

<!-- Brand Panel -->
<div class="brand-panel">
  <div class="bp-orb bp-orb-1"></div>
  <div class="bp-orb bp-orb-2"></div>
  <div class="bp-content">
    <img class="bp-logo" src="Plus_Dev_No_Wellpeper.png" alt="Plus Dev">
    <div class="bp-title">Plus <span>Dev</span></div>
    <p class="bp-desc">Ø³ÙŠØ±ÙØ± FiveM Ø§Ø­ØªØ±Ø§ÙÙŠ Ù…ØªØ®ØµØµ â€” Ø³ÙƒØ±Ø¨ØªØ§ØªØŒ Ø´Ø±ÙˆØ­Ø§ØªØŒ ÙˆÙˆØ¸Ø§Ø¦Ù Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø±ÙˆÙ„ Ø¨Ù„Ø§ÙŠ Ø§Ù„Ø¹Ø±Ø¨ÙŠ</p>
    <div class="bp-stats">
      <div class="bp-stat"><div class="bp-stat-num">128<span>+</span></div><div class="bp-stat-lbl">Ù„Ø§Ø¹Ø¨ Ù…Ø²Ø§Ù…Ù†</div></div>
      <div class="bp-stat"><div class="bp-stat-num">500<span>+</span></div><div class="bp-stat-lbl">Ø¹Ø¶Ùˆ Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯</div></div>
      <div class="bp-stat"><div class="bp-stat-num">50<span>+</span></div><div class="bp-stat-lbl">Ø³ÙƒØ±Ø¨Øª</div></div>
    </div>
    <div class="bp-features">
      <div class="bp-feat">
        <div class="bp-feat-icon"><i class="fas fa-shield-alt"></i></div>
        <div class="bp-feat-text"><strong>Ø£Ù…Ø§Ù† ØªØ§Ù…</strong>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù† Ø¹Ø¨Ø± Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯ Ø§Ù„Ø±Ø³Ù…ÙŠ</div>
      </div>
      <div class="bp-feat">
        <div class="bp-feat-icon"><i class="fas fa-bolt"></i></div>
        <div class="bp-feat-text"><strong>ÙˆØµÙˆÙ„ ÙÙˆØ±ÙŠ</strong>ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ø§ØªÙƒ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø­Ø³Ø§Ø¨Ùƒ Ù…Ø¨Ø§Ø´Ø±Ø©</div>
      </div>
      <div class="bp-feat">
        <div class="bp-feat-icon"><i class="fas fa-headset"></i></div>
        <div class="bp-feat-text"><strong>Ø¯Ø¹Ù… Ù…Ø³ØªÙ…Ø±</strong>ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© 24/7</div>
      </div>
    </div>
  </div>
</div>

<!-- Form Panel -->
<div class="form-panel">
  <a href="index.html" class="back-btn"><i class="fas fa-arrow-right"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <div class="form-inner">

    <div class="form-greeting">
      <div class="form-tag">
        <span class="form-tag-dot"></span>
        Ø§Ù„Ø³ÙŠØ±ÙØ± Ø´ØºÙ‘Ø§Ù„ Ø§Ù„Ø¢Ù†
      </div>
      <h2>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹</h2>
      <p>Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</p>
    </div>

    <div class="tabs">
      <button class="tab on" onclick="switchTab('discord')"><i class="fab fa-discord"></i> Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯</button>
      <button class="tab" onclick="switchTab('email')"><i class="fas fa-envelope"></i> Ø¥ÙŠÙ…ÙŠÙ„</button>
    </div>

    <div class="alert" id="alert"></div>

    <!-- Discord Panel -->
    <div class="panel on" id="p-discord">
      <button class="discord-btn" onclick="loginDiscord()">
        <i class="fab fa-discord"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Discord
      </button>
      <p class="discord-note">Ø³ÙŠØªÙ… Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ù† Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØ­ÙØ¸Ù‡Ø§ Ø¨Ø£Ù…Ø§Ù† ØªØ§Ù…</p>
      <div class="alt-login-box">
        <p>Ù…Ø§ Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯ØŸ</p>
        <button class="alt-login-btn" onclick="switchTab('email')">
          <i class="fas fa-envelope" style="margin-left:6px;"></i> ØªØ³Ø¬ÙŠÙ„ Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        </button>
      </div>
    </div>

    <!-- Email Panel -->
    <div class="panel" id="p-email">
      <div class="link-banner" id="link-banner">
        <i class="fab fa-discord" style="color:#9da7fb;margin-left:5px"></i>
        <strong>Ø¥ÙŠÙ…ÙŠÙ„Ùƒ Ù…Ø±ØªØ¨Ø· Ø¨Ø­Ø³Ø§Ø¨ Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯!</strong><br>
        ØªØ¨ØºÙ‰ ØªØ±Ø¨Ø·Ù‡Ù… Ø¹Ø´Ø§Ù† ØªÙ‚Ø¯Ø± ØªØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚ØªÙŠÙ†ØŸ
        <div class="link-actions">
          <button class="lbtn lbtn-y" onclick="confirmLink()"><i class="fab fa-discord"></i> Ù†Ø¹Ù…ØŒ Ø§Ø±ØªØ¨Ø·</button>
          <button class="lbtn lbtn-n" onclick="dismissLink()">Ø¯Ø®ÙˆÙ„ ÙÙ‚Ø·</button>
        </div>
      </div>
      <form id="ef" onsubmit="submitEmail(event)" novalidate>
        <div class="fg">
          <label for="em">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <div class="iw">
            <input type="email" id="em" placeholder="example@gmail.com" autocomplete="email" required>
            <i class="fas fa-envelope ic"></i>
          </div>
        </div>
        <div class="fg">
          <label for="pw">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <div class="iw">
            <input type="password" id="pw" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" required>
            <i class="fas fa-lock ic"></i>
            <button type="button" class="eye" onclick="togglePw()"><i class="fas fa-eye" id="eye"></i></button>
          </div>
        </div>
        <div class="extras">
          <label class="rem"><input type="checkbox" id="rem"> ØªØ°ÙƒØ±Ù†ÙŠ</label>
          <a href="#" class="forgot" onclick="forgotPw();return false">Ù†Ø³ÙŠØª Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ØŸ</a>
        </div>
        <button type="submit" class="sbtn" id="sbtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      </form>
      <div class="sw">Ù…Ø§ Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" onclick="switchTab('discord');return false">Ø³Ø¬Ù‘Ù„ Ø¹Ø¨Ø± Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯</a></div>
    </div>

    <div class="foot">
      Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ <a href="#">Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a> Ùˆ<a href="#">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
      <br><br><span style="color:#1e1e1e">Â© Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ±ÙØ± 2025</span>
    </div>
  </div>
</div>

<script src="config.js"></script>
<script>
const CLIENT_ID = CONFIG.DISCORD_CLIENT_ID;
const REDIRECT_URI = CONFIG.REDIRECT_URI;

function switchTab(t){
  document.querySelectorAll('.tab').forEach((b,i)=>b.classList.toggle('on',(t==='discord'&&i===0)||(t==='email'&&i===1)));
  document.getElementById('p-discord').classList.toggle('on',t==='discord');
  document.getElementById('p-email').classList.toggle('on',t==='email');
  clearAlert();
}
function showAlert(msg,type='err'){
  const icons={err:'fa-circle-exclamation',ok:'fa-circle-check',inf:'fa-circle-info'};
  const el=document.getElementById('alert');
  el.className=`alert on ${type}`;
  el.innerHTML=`<i class="fas ${icons[type]}"></i> ${msg}`;
}
function clearAlert(){const el=document.getElementById('alert');el.className='alert';el.innerHTML='';}
async function generatePKCE(){
  const verifier=Array.from(crypto.getRandomValues(new Uint8Array(32))).map(b=>b.toString(16).padStart(2,'0')).join('');
  const digest=await crypto.subtle.digest('SHA-256',new TextEncoder().encode(verifier));
  const challenge=btoa(String.fromCharCode(...new Uint8Array(digest))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=/g,'');
  return{verifier,challenge};
}
async function loginDiscord(){
  const state=Math.random().toString(36).slice(2);
  const{verifier,challenge}=await generatePKCE();
  sessionStorage.setItem('oauth_state',state);
  sessionStorage.setItem('code_verifier',verifier);
  window.location.href=`https://discord.com/api/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=code&scope=identify+email&state=${state}&code_challenge=${challenge}&code_challenge_method=S256`;
}
function togglePw(){
  const i=document.getElementById('pw'),e=document.getElementById('eye');
  if(i.type==='password'){i.type='text';e.className='fas fa-eye-slash';}
  else{i.type='password';e.className='fas fa-eye';}
}
async function submitEmail(e){
  e.preventDefault();
  const em=document.getElementById('em').value.trim();
  const pw=document.getElementById('pw').value;
  const rem=document.getElementById('rem').checked;
  if(!em||!pw){showAlert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');return;}
  const btn=document.getElementById('sbtn');
  btn.disabled=true;btn.innerHTML='<span class="spin"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
  clearAlert();
  try{
    const{getAuth,signInWithEmailAndPassword,browserLocalPersistence,browserSessionPersistence,setPersistence}=await import('https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js');
    const auth=getAuth();
    await setPersistence(auth,rem?browserLocalPersistence:browserSessionPersistence);
    const cred=await signInWithEmailAndPassword(auth,em,pw);
    const{getFirestore,doc,getDoc}=await import('https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js');
    const db=getFirestore();
    const snap=await getDoc(doc(db,'users',cred.user.uid));
    if(!snap.exists()){showAlert('Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');btn.disabled=false;btn.innerHTML='ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';return;}
    const data=snap.data();
    const uName = data.username || data.global_name || cred.user.email;
    localStorage.setItem('user',JSON.stringify({id:data.discordId||cred.user.uid,name:uName,username:uName,avatar:data.avatar||'',email:cred.user.email}));
    showAlert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ“','ok');
    setTimeout(()=>{window.location.href='index.html';},900);
  }catch(err){
    const msgs={'auth/user-not-found':'Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„','auth/wrong-password':'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©','auth/invalid-email':'Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± ØµØ­ÙŠØ­','auth/too-many-requests':'Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹','auth/invalid-credential':'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø®Ø§Ø·Ø¦'};
    showAlert(msgs[err.code]||'Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
    btn.disabled=false;btn.innerHTML='ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
  }
}
function forgotPw(){showAlert('ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¹Ø¨Ø± Ø§Ù„Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯ Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯','inf');}
function confirmLink(){document.getElementById('link-banner').classList.remove('on');showAlert('ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­ âœ“','ok');}
function dismissLink(){document.getElementById('link-banner').classList.remove('on');}

(async function handleCallback(){
  const params=new URLSearchParams(location.search);
  const code=params.get('code');
  const state=params.get('state');
  if(!code)return;
  if(state!==sessionStorage.getItem('oauth_state')){showAlert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');return;}
  switchTab('discord');
  showAlert('Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...','inf');
  try{
    const codeVerifier=sessionStorage.getItem('code_verifier');
    const tokenRes=await fetch('https://discord.com/api/oauth2/token',{
      method:'POST',
      headers:{'Content-Type':'application/x-www-form-urlencoded'},
      body:new URLSearchParams({client_id:CLIENT_ID,grant_type:'authorization_code',code,redirect_uri:REDIRECT_URI,code_verifier:codeVerifier||''})
    });
    const tokenData=await tokenRes.json();
    if(!tokenData.access_token){showAlert('ÙØ´Ù„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ†');return;}
    const userRes=await fetch('https://discord.com/api/users/@me',{headers:{Authorization:`Bearer ${tokenData.access_token}`}});
    const user=await userRes.json();
    if(!user.id){showAlert('ÙØ´Ù„ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');return;}
    const displayName = user.global_name || user.username || user.id;
    localStorage.setItem('user',JSON.stringify({id:user.id,name:displayName,username:displayName,global_name:user.global_name||'',avatar:user.avatar?`https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`:'',email:user.email||''}));
    showAlert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ“','ok');
    history.replaceState({},'',location.pathname);
    setTimeout(()=>{window.location.href='index.html';},900);
  }catch(e){showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');}
})();
</script>
</body>
</html>